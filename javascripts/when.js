;(function(e){"use strict";e(function(){function r(e,t,n,r){return i(e).then(t,n,r)}function i(e){var t,n;if(e instanceof o){t=e}else{if(l(e)){n=f();e.then(function(e){n.resolve(e)},function(e){n.reject(e)},function(e){n.progress(e)});t=n.promise}else{t=u(e)}}return t}function s(e){return r(e,a)}function o(e){this.then=e}function u(e){var t=new o(function(t){try{return i(t?t(e):e)}catch(n){return a(n)}});return t}function a(e){var t=new o(function(t,n){try{return n?i(n(e)):a(e)}catch(r){return a(r)}});return t}function f(){function h(e,t,n){return u(e,t,n)}function p(e){return c(e)}function d(e){return c(a(e))}function v(e){return l(e)}var e,t,r,s,u,l,c;t=new o(h);e={then:h,resolve:p,reject:d,progress:v,promise:t,resolver:{resolve:p,reject:d,progress:v}};r=[];s=[];u=function(e,t,n){var i,o;i=f();o=typeof n==="function"?function(e){try{i.progress(n(e))}catch(t){i.progress(t)}}:function(e){i.progress(e)};r.push(function(n){n.then(e,t).then(i.resolve,i.reject,o)});s.push(o);return i.promise};l=function(e){y(s,e);return e};c=function(e){e=i(e);u=e.then;c=i;l=w;y(r,e);s=r=n;return e};return e}function l(e){return e&&typeof e.then==="function"}function c(e,t,n,i,s){b(2,arguments);return r(e,function(e){function g(e){p(e)}function y(e){h(e)}var o,u,a,l,c,h,p,d,v,m;v=e.length>>>0;o=Math.max(0,Math.min(t,v));a=[];u=v-o+1;l=[];c=f();if(!o){c.resolve(a)}else{d=c.progress;p=function(e){l.push(e);if(!--u){h=p=w;c.reject(l)}};h=function(e){a.push(e);if(!--o){h=p=w;c.resolve(a)}};for(m=0;m<v;++m){if(m in e){r(e[m],y,g,d)}}}return c.then(n,i,s)})}function h(e,t,n,r){function i(e){return t?t(e[0]):e[0]}return c(e,1,i,n,r)}function p(e,t,n,r){b(1,arguments);return v(e,E).then(t,n,r)}function d(){return v(arguments,E)}function v(e,t){return r(e,function(e){var n,i,s,o,u,a;s=i=e.length>>>0;n=[];a=f();if(!s){a.resolve(n)}else{o=function(i,o){r(i,t).then(function(e){n[o]=e;if(!--s){a.resolve(n)}},a.reject)};for(u=0;u<i;u++){if(u in e){o(e[u],u)}else{--s}}}return a.promise})}function m(n,i){var s=t.call(arguments,1);return r(n,function(t){var n;n=t.length;s[0]=function(e,t,s){return r(e,function(e){return r(t,function(t){return i(e,t,s,n)})})};return e.apply(t,s)})}function g(e,t,n){var i=arguments.length>2;return r(e,function(e){e=i?n:e;t.resolve(e);return e},function(e){t.reject(e);return a(e)},t.progress)}function y(e,t){var n,r=0;while(n=e[r++]){n(t)}}function b(e,t){var n,r=t.length;while(r>e){n=t[--r];if(n!=null&&typeof n!="function"){throw new Error("arg "+r+" must be a function")}}}function w(){}function E(e){return e}var e,t,n;r.defer=f;r.resolve=i;r.reject=s;r.join=d;r.all=p;r.map=v;r.reduce=m;r.any=h;r.some=c;r.chain=g;r.isPromise=l;o.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(n,e)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return p(t,function(t){return e.apply(n,t)})})}};t=[].slice;e=[].reduce||function(e){var t,n,r,i,s;s=0;t=Object(this);i=t.length>>>0;n=arguments;if(n.length<=1){for(;;){if(s in t){r=t[s++];break}if(++s>=i){throw new TypeError}}}else{r=n[1]}for(;s<i;++s){if(s in t){r=e(r,t[s],s,t)}}return r};return r})})(typeof define=="function"&&define.amd?define:function(e){typeof exports==="object"?module.exports=e():this.when=e()})
