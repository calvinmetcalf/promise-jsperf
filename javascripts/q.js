;(function(e){if(typeof bootstrap==="function"){bootstrap("promise",e)}else if(typeof exports==="object"){module.exports=e()}else if(typeof define==="function"){define(e)}else if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=e}}else{Q=e()}})(function(){"use strict";function g(e){return m(e)==="[object StopIteration]"||e instanceof y}function w(e,t){if(t.stack&&typeof e==="object"&&e!==null&&e.stack&&e.stack.indexOf(b)===-1){e.stack=E(e.stack)+"\n"+b+"\n"+E(t.stack)}}function E(e){var t=e.split("\n");var n=[];for(var r=0;r<t.length;++r){var i=t[r];if(!x(i)&&!S(i)){n.push(i)}}return n.join("\n")}function S(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function x(n){var r=/at .+ \((.*):(\d+):\d+\)/.exec(n);if(!r){return false}var i=r[1];var s=r[2];return i===t&&s>=e&&s<=gt}function T(){if(Error.captureStackTrace){var e,n;var r=Error.prepareStackTrace;Error.prepareStackTrace=function(t,r){e=r[1].getFileName();n=r[1].getLineNumber()};(new Error).stack;Error.prepareStackTrace=r;t=e;return n}}function N(e,t,n){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack)}return e.apply(e,arguments)}}function C(e){return U(e)}function k(){function u(r){if(!e){return}n=U(r);c(e,function(e,t){i(function(){n.promiseDispatch.apply(n,t)})},void 0);e=void 0;t=void 0}var e=[],t=[],n;var s=d(k.prototype);var o=d(A.prototype);o.promiseDispatch=function(r,s,o){var u=l(arguments);if(e){e.push(u);if(s==="when"&&o[1]){t.push(o[1])}}else{i(function(){n.promiseDispatch.apply(n,u)})}};o.valueOf=function(){if(e){return o}n=O(n);return n};if(Error.captureStackTrace){Error.captureStackTrace(o,k);o.stack=o.stack.substring(o.stack.indexOf("\n")+1)}r(o);s.promise=o;s.resolve=u;s.fulfill=function(e){u(R(e))};s.reject=function(e){u(q(e))};s.notify=function(n){if(e){c(t,function(e,t){i(function(){t(n)})},void 0)}};return s}function L(e){var t=k();tt(e,t.resolve,t.reject,t.notify).fail(t.reject);return t.promise}function A(e,t,n,i){if(t===void 0){t=function(e){return q(new Error("Promise does not support operation: "+e))}}var s=d(A.prototype);s.promiseDispatch=function(n,r,i){var o;try{if(e[r]){o=e[r].apply(s,i)}else{o=t.call(s,r,i)}}catch(u){o=q(u)}if(n){n(o)}};if(n){s.valueOf=n}if(i){s.exception=i}r(s);return s}function O(e){if(M(e)){return e.valueOf()}return e}function M(e){return e&&typeof e.promiseDispatch==="function"}function _(e){return e&&typeof e.then==="function"}function D(e){return!P(e)&&!H(e)}function P(e){return!_(O(e))}function H(e){e=O(e);return M(e)&&"exception"in e}function I(){if(!F&&typeof window!=="undefined"&&!window.Touch&&window.console){console.log("Should be empty:",j)}F=true}function q(e){var t=A({when:function(t){if(t){var n=h(B,this);if(n!==-1){j.splice(n,1);B.splice(n,1)}}return t?t(e):q(e)}},function(){return q(e)},function n(){return this},e);I();B.push(t);j.push(e);return t}function R(e){return A({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t];return e},post:function(t,n){if(t==null){return e.apply(void 0,n)}else{return e[t].apply(e,n)}},apply:function(t){return e.apply(void 0,t)},keys:function(){return v(e)}},void 0,function t(){return e})}function U(e){if(M(e)){return e}e=O(e);if(_(e)){return z(e)}else{return R(e)}}function z(e){var t=k();e.then(t.resolve,t.reject,t.notify);return t.promise}function W(e){return A({isDef:function(){}},function(n,r){return Q(e,n,r)},function(){return O(e)})}function X(e,t,n,r){function u(e){try{return typeof t==="function"?t(e):e}catch(n){return q(n)}}function a(e){if(typeof n==="function"){w(e,l);try{return n(e)}catch(t){return q(t)}}return q(e)}function f(e){return typeof r==="function"?r(e):e}var s=k();var o=false;var l=U(e);i(function(){l.promiseDispatch(function(e){if(o){return}o=true;s.resolve(u(e))},"when",[function(e){if(o){return}o=true;s.resolve(a(e))}])});l.promiseDispatch(void 0,"when",[void 0,function(e){var t;var n=false;try{t=f(e)}catch(r){n=true;if(C.onerror){C.onerror(r)}else{throw r}}if(!n){s.notify(t)}}]);return s.promise}function V(e,t,n){return X(e,function(e){return rt(e).then(function(e){return t.apply(void 0,e)},n)},n)}function $(e){return function(){function t(e,t){var s;try{s=n[e](t)}catch(o){if(g(o)){return o.value}else{return q(o)}}return X(s,r,i)}var n=e.apply(this,arguments);var r=t.bind(t,"send");var i=t.bind(t,"throw");return r()}}function J(e){throw new y(e)}function K(e){return function(){return V([this,rt(arguments)],function(t,n){return e.apply(t,n)})}}function Q(e,t,n){var r=k();i(function(){U(e).promiseDispatch(r.resolve,t,n)});return r.promise}function G(e){return function(t){var n=l(arguments,1);return Q(t,e,n)}}function Z(e,t){var n=l(arguments,2);return Y(e,t,n)}function tt(e){var t=l(arguments,1);return et(e,t)}function nt(e){var t=l(arguments,1);return function(){var r=t.concat(l(arguments));return et(e,r)}}function rt(e){return X(e,function(e){var t=e.length;if(t===0){return U(e)}var n=k();c(e,function(r,i,s){if(P(i)){e[s]=O(i);if(--t===0){n.resolve(e)}}else{X(i,function(r){e[s]=r;if(--t===0){n.resolve(e)}}).fail(n.reject)}},void 0);return n.promise})}function it(e){return X(e,function(e){return X(rt(p(e,function(e){return X(e,n,n)})),function(){return p(e,U)})})}function st(e,t){return X(e,void 0,t)}function ot(e,t){return X(e,void 0,void 0,t)}function ut(e,t){return X(e,function(e){return X(t(),function(){return e})},function(e){return X(t(),function(){return q(e)})})}function at(e,t,n,r){var s=function(t){i(function(){w(t,e);if(C.onerror){C.onerror(t)}else{throw t}})};var o=t||n||r?X(e,t,n,r):e;if(typeof process==="object"&&process&&process.domain){s=process.domain.bind(s)}st(o,s)}function ft(e,t){var n=k();var r=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);X(e,function(e){clearTimeout(r);n.resolve(e)},function(e){clearTimeout(r);n.reject(e)});return n.promise}function lt(e,t){if(t===void 0){t=e;e=void 0}var n=k();setTimeout(function(){n.resolve(e)},t);return n.promise}function ct(e,t){var n=l(t);var r=k();n.push(r.makeNodeResolver());et(e,n).fail(r.reject);return r.promise}function ht(e){var t=l(arguments,1);var n=k();t.push(n.makeNodeResolver());et(e,t).fail(n.reject);return n.promise}function pt(e){var t=l(arguments,1);return function(){var n=t.concat(l(arguments));var r=k();n.push(r.makeNodeResolver());et(e,n).fail(r.reject);return r.promise}}function dt(e,t,n){var r=l(n);var i=k();r.push(i.makeNodeResolver());Y(e,t,r).fail(i.reject);return i.promise}function vt(e,t){var n=l(arguments,2);var r=k();n.push(r.makeNodeResolver());Y(e,t,n).fail(r.reject);return r.promise}function mt(e,t){if(t){e.then(function(e){i(function(){t(null,e)})},function(e){i(function(){t(e)})})}else{return e}}var e=T();var t;var n=function(){};var r=Object.freeze||n;if(typeof cajaVM!=="undefined"){r=cajaVM.def}var i;if(typeof process!=="undefined"){i=process.nextTick}else if(typeof setImmediate==="function"){i=setImmediate}else if(typeof MessageChannel!=="undefined"){var s=new MessageChannel;var o={},u=o;s.port1.onmessage=function(){o=o.next;var e=o.task;delete o.task;e()};i=function(e){u=u.next={task:e};s.port2.postMessage(0)}}else{i=function(e){setTimeout(e,0)}}var a;if(Function.prototype.bind){var f=Function.prototype.bind;a=f.bind(f.call)}else{a=function(e){return function(){return e.call.apply(e,arguments)}}}var l=a(Array.prototype.slice);var c=a(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1){do{if(n in this){t=this[n++];break}if(++n>=r){throw new TypeError}}while(1)}for(;n<r;n++){if(n in this){t=e(t,this[n],n)}}return t});var h=a(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++){if(this[t]===e){return t}}return-1});var p=a(Array.prototype.map||function(e,t){var n=this;var r=[];c(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0);return r});var d=Object.create||function(e){function t(){}t.prototype=e;return new t};var v=Object.keys||function(e){var t=[];for(var n in e){t.push(n)}return t};var m=Object.prototype.toString;var y;if(typeof ReturnValue!=="undefined"){y=ReturnValue}else{y=function(e){this.value=e}}var b="From previous event:";C.nextTick=i;C.defer=k;k.prototype.makeNodeResolver=function(){var e=this;return function(t,n){if(t){e.reject(t)}else if(arguments.length>2){e.resolve(l(arguments,1))}else{e.resolve(n)}}};C.promise=L;C.makePromise=A;A.prototype.then=function(e,t,n){return X(this,e,t,n)};A.prototype.thenResolve=function(e){return X(this,function(){return e})};c(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(e,t){A.prototype[t]=function(){return C[t].apply(C,[this].concat(l(arguments)))}},void 0);A.prototype.toSource=function(){return this.toString()};A.prototype.toString=function(){return"[object Promise]"};r(A.prototype);C.nearer=O;C.isPromise=M;C.isPromiseAlike=_;C.isPending=D;C.isFulfilled=P;C.isRejected=H;var B=[];var j=[];var F;C.reject=q;C.fulfill=R;C.resolve=U;C.master=W;C.when=X;C.spread=V;C.async=$;C["return"]=J;C.promised=K;C.dispatch=Q;C.dispatcher=G;C.get=G("get");C.set=G("set");C["delete"]=C.del=G("delete");var Y=C.post=G("post");C.send=Z;C.invoke=Z;var et=C.fapply=G("apply");C["try"]=tt;C.fcall=tt;C.fbind=nt;C.keys=G("keys");C.all=rt;C.allResolved=it;C["catch"]=C.fail=st;C.progress=ot;C["finally"]=C.fin=ut;C.done=at;C.timeout=ft;C.delay=lt;C.nfapply=ct;C.nfcall=ht;C.nfbind=pt;C.npost=dt;C.nsend=vt;C.ninvoke=C.nsend;C.nodeify=mt;var gt=T();return C})
